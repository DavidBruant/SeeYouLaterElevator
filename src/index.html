<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="http://necolas.github.io/normalize.css/2.1.3/normalize.css">
    <link rel="stylesheet" type="text/css" href="https://rawgithub.com/marijnh/CodeMirror/master/lib/codemirror.css">
    <link rel="stylesheet" type="text/css" href="https://rawgithub.com/marijnh/CodeMirror/master/theme/solarized.css">
    <style>
        .column {
          display: inline-block;
          vertical-align: top;
          width: 45%;
        }

        .building{
            position: relative;
            left: 100px;
        }

        .building * {
          -webkit-box-sizing: border-box;
          -moz-box-sizing: border-box;
          box-sizing: border-box;
        }

        .shaft {
          display: inline-block;
          position: relative;
        }

        .floor, .elevator {
          margin: 5px 0;
        }

        .floor{
          background-color: #874;
          height: 100px;
          width: 100px;
        }
          .floor:before{
            content: attr(data-level);
          }

        .elevator{
            padding: 10px;
            position: absolute;
            bottom: 10px;
            left: 60px;
            width: 90px;
            height: 90px;
            background-color: #647;
            color: #DDD;

            transition-timing-function: ease;
            transition-property: bottom;
        }

        .elevator:nth-of-type(2){
            left: -60px;

        }


        #run-code{
            position: relative;
            top: 50px;
            width: 200px;
            height: 100px;
        }
    </style>
    <script src="https://rawgithub.com/marijnh/CodeMirror/master/lib/codemirror.js"></script>
    <script src="https://rawgithub.com/marijnh/CodeMirror/master/mode/javascript/javascript.js"></script>
    <script src="../bower_components/lodash/dist/lodash.min.js"></script>
    <script src="../bower_components/machina/lib/machina.min.js"></script>
    <script src="Elevator.js"></script>

    <script>
    function floorRequestsScenario(elevators){
      var f = 0;
      elevators[f++].goToFloor(2).goToFloor(3).goToFloor(4).goToFloor(1);
      elevators[f++].goToFloor(3).goToFloor(4).goToFloor(3).goToFloor(1);
      elevators[f++].goToFloor(4).goToFloor(3).goToFloor(2).goToFloor(1);
      elevators[f++].goToFloor(4).goToFloor(1).goToFloor(4).goToFloor(1);
    }
    </script>

    <script>
      var elevators = {};

      (function(global){
            "use strict";

            document.addEventListener('DOMContentLoaded', function(){

              elevators = [].slice.call(document.querySelectorAll('.shaft .elevator')).map(function(el){
                return new Elevator({
                  el: el
                });
              });

              //Object.freeze(elevators);
            });

            global.runScenarios = function runScenarios(elevators){
                elevatorStrategy(elevators)

                floorRequestsScenario(elevators);

                if(typeof elevatorStrategy !== 'function')
                    throw new Error('An "elevatorStrategy" function must be defined somewhere');

            };

      })(this);
    </script>

<!--
Need to listen to floorRequests (indifferenciated of whether it comes from the inside or outside)
-->
<script id="evaluated-scripts">
function elevatorStrategy (elevators) {

    /*elevators.on('floorRequest', function (floor) {
        elevators[ Math.random() < 0.5 ? 0 : 1].goToFloor(floor);
    });*/

}
</script>

    <title> See you later elevator </title>
  </head>

  <body>
      <div class="building column">
        <dl class="shaft">
          <dt class="elevator" data-at-floor="1">Elevator</dt>
          <dd class="floor" data-level="4"></dd>
          <dd class="floor" data-level="3"></dd>
          <dd class="floor" data-level="2"></dd>
          <dd class="floor" data-level="1"></dd>
        </dl>
        <dl class="shaft">
          <dt class="elevator" data-at-floor="1">Elevator</dt>
          <dd class="floor" data-level="4"></dd>
          <dd class="floor" data-level="3"></dd>
          <dd class="floor" data-level="2"></dd>
          <dd class="floor" data-level="1"></dd>
        </dl>
        <dl class="shaft">
          <dt class="elevator" data-at-floor="1">Elevator</dt>
          <dd class="floor" data-level="4"></dd>
          <dd class="floor" data-level="3"></dd>
          <dd class="floor" data-level="2"></dd>
          <dd class="floor" data-level="1"></dd>
        </dl>
        <dl class="shaft">
          <dt class="elevator" data-at-floor="1">Elevator</dt>
          <dd class="floor" data-level="4"></dd>
          <dd class="floor" data-level="3"></dd>
          <dd class="floor" data-level="2"></dd>
          <dd class="floor" data-level="1"></dd>
        </dl>
      </div>

      <div class="column">
        <textarea id="editor" cols="30" rows="10"></textarea>

        <button id="run-code">Run Code</button>
      </div>



      <script type="text/javascript"> // CodeMirror
        (function(d){
          var editor = d.getElementById('editor');
          editor.innerHTML = d.getElementById('evaluated-scripts').innerHTML;

          var strategyEditor = CodeMirror.fromTextArea(editor, {
            mode: {name: "javascript", json: true},
            lineNumbers: true,
            autofocus: true,
            theme: "solarized dark"
          });

          strategyEditor.setSize('100%', '100%');

          d.getElementById('run-code').addEventListener('click', function(){
              eval(strategyEditor.getValue());
              runScenarios(elevators);
          });
        })(document);
      </script>
  </body>
</html>
